<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport"
        content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover">
  <meta name="format-detection" content="telephone=no,address=no,email=no">
  <meta name="applicable-device" content="pc,mobile">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <meta http-equiv="Cache-Control" content="no-transform">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="renderer" content="webkit">
  <meta name="description" content="领先的国际货运智能化数字服务平台，拥有极速订舱、在线报关、航班跟踪、舱单生成四大功能，为国际货运企业提供灵活、专业、高效的一站式国际货运解决方案。">
  <meta name="keywords" content="空运,货运代理,航空货运,空运价格,国际货代,国际空运,订舱,空运货物查询跟踪,订舱报价,空运舱位,空运费查询,跨境物流,走空运找哪里">
  <link rel='icon' href='./img/favicon.ico' type='image/x-icon'/>
  <title>17订舱-国际货代-空运价格-在线订舱-航线-一站式国际货运在线服务平台</title>
  <link rel="stylesheet" href="./css/element-ui-min.css">
  <link rel="stylesheet" href="./css/reset.css"/>
  <link rel="stylesheet" href="./css/common.css"/>
  <link rel="stylesheet" href="./css/corporate.css"/>
  <script src="./js/vue.js"></script>
  <script src="./js/axios.min.js"></script>
  <script src="./js/element-ui.js"></script>
  <script>
      var _hmt = _hmt || [];
      (function () {
          var hm = document.createElement("script");
          hm.src = "https://hm.baidu.com/hm.js?6557743b6903181767d9b1a4d7458530";
          var s = document.getElementsByTagName("script")[0];
          s.parentNode.insertBefore(hm, s);
      })();
  </script>
</head>
<body>
<div id="app">
  <!-- 头部 -->
  <div class="header">
    <div class="header-img">
      <a href="./index.html">
        <!-- <img class="logo" src="./img/logo.png" /> -->
        <div class="logo"></div>
      </a>
      <div class="logo-title"></div>
    </div>
    <div v-if="userInfo" @mousemove="showHeaderMenu(1)" @mouseout="showHeaderMenu(2)" class="header-userInfo">
      <img class="header-imgUrl" :src="userInfo.headImgUrl"/>
      <div v-show="headerMenu" style="display: none;" class="header-userInfo-menu">
        <div class="header-userInfo-menu-name">{{userInfo.nickname}}</div>
        <div class="header-bak"><a href="./corporate.html">企业认证</a></div>
        <div class="header-bak"><a href="./orderList.html">订单管理</a></div>
        <div class="header-bak"><a href="./financial.html">财务管理</a></div>
        <div @click="tuiChu" class="header-bak">退出</div>
      </div>
    </div>
    <div v-else @click="loginClick" class="header-user">登录</div>
  </div>
  <div class="header-menu">
    <ul class="header-menu-list com-width">
      <li @click="menuClick(0)" :class="{headerActive: menuIndex == 0}" class="header-menu-content">首页</li>
      <li @click="menuClick(1)" :class="{headerActive: menuIndex == 1}" class="header-menu-content">订单跟踪</li>
      <!-- <li @click="menuClick(2)" :class="{headerActive: menuIndex == 2}" class="header-menu-content">行业咨询</li> -->
      <li @click="menuClick(3)" :class="{headerActive: menuIndex == 3}" class="header-menu-content">关于我们</li>
    </ul>
  </div>
  <!-- 订单管理 -->
  <div class="order-list">
    <div class="com-width order-list-content">
      <div class="order-list-userInfo">
        <div class="list-userInfo-menu">
          <div class="userInfo-touxiang-list">
            <div class="userInfo-touxiang-img">
              <img alt="图片" :src="userInfo.headImgUrl"/>
            </div>
            <div class="userInfo-huanyin">欢迎您{{userInfo.nickname}}</div>
            <div class="userInfo-youxiang">设置邮箱</div>
          </div>
          <ul class="userInfo-menu-list">
            <li class="menu-list-active"><a href="./corporate.html">企业信息</a></li>
            <li><a href="./orderList.html">订单管理</a></li>
            <li><a href="./financial.html">财务管理</a></li>
          </ul>
        </div>
        <div class="list-userInfo-customer">
          <div class="userInfo-customer">
            <div>您的专属客服:</div>
            <div>nana</div>
          </div>
          <div class="userInfo-customer">
            <div>欢迎致电:</div>
            <div>13567862626</div>
          </div>
        </div>
      </div>
      <div class="order-list-manage">
        <div class="order-list-manage-title">企业认证</div>
        <div class="tabs__nav-wrap">
          <el-tabs v-model="typeCode" type="border-card" @tab-click="tabClickData">
            <el-tab-pane label="发票开具" name="发票开具">
              <div class="financial-invoice">
                <div class="financial-invoice-table">
                  <el-table
                    class="financial-table"
                    :data="tableData1"
                    @selection-change="selectionChange"
                    stripe
                    style="width: 100%">
                    <el-table-column type="selection" width="50"></el-table-column>
                    <el-table-column prop="waybillNo" label="运单号" min-width="120"></el-table-column>
                    <el-table-column prop="departureDate" label="航班日期" min-width="100"></el-table-column>
                    <el-table-column prop="reconciliationUnit" label="对账单位" min-width="180"></el-table-column>
                    <el-table-column prop="fullLeg" label="航线" min-width="120"></el-table-column>
                    <el-table-column prop="billAmountCny" label="订单总金额" min-width="100"></el-table-column>
                  </el-table>
                </div>
              </div>
            </el-tab-pane>
            <el-tab-pane label="开票信息" name="开票信息">
              <div class="tableList">
                <div class="title">
                  <span>发票抬头信息</span>
                  <el-button @click="changeDialog('新增发票抬头信息',1)" size="medium" type="primary">新增</el-button>
                </div>
                <el-table
                  :data="invoiceListData"
                  stripe
                  border
                  align="center"
                  style="width: 100%">
                  <el-table-column
                    type="index"
                    label="序号"
                    :index="indexMethod">
                  </el-table-column>
                  <el-table-column prop="invoiceTitle" label="发票抬头"></el-table-column>
                  <el-table-column prop="dutyParagraph" label="纳税人识别号"></el-table-column>
                  <el-table-column label="公司地址及电话">
                    <template slot-scope="scope">
                      <span>{{scope.row.companyAddress}}  {{scope.row.companyTel}}</span>
                    </template>
                  </el-table-column>
                  <el-table-column label="开户行及账号">
                    <template slot-scope="scope">
                      <span>{{scope.row.accountBank}}  {{scope.row.bankAccount}}</span>
                    </template>
                  </el-table-column>
                  <el-table-column prop="createTime" label="添加时间" width="160px"></el-table-column>
                  <el-table-column label="操作">
                    <template slot-scope="scope">
                      <div class="btn">
                        <div class="edit" @click="changeDialog('编辑发票抬头信息',2,scope.row)">编辑</div>
                        <div class="dele" @click="deleInvoice(scope.row.id,1)">删除</div>
                      </div>
                    </template>
                  </el-table-column>
                </el-table>
              </div>
              <div class="tableList">
                <div class="title">
                  <span>发票邮寄信息</span>
                  <el-button @click="expressDialog('新增发票邮寄信息',1)" size="medium" type="primary">新增</el-button>
                </div>
                <el-table
                  :data="expressListData"
                  stripe
                  border
                  align="center"
                  style="width: 100%">
                  <el-table-column
                    type="index"
                    label="序号"
                    :index="indexMethod">
                  </el-table-column>
                  <el-table-column prop="recipient" label="收件人"></el-table-column>
                  <el-table-column prop="recipientTel" label="联系电话"></el-table-column>
                  <el-table-column prop="recipientEmail" label="邮箱"></el-table-column>
                  <el-table-column prop="recipientAddress" label="收件地址"></el-table-column>
                  <el-table-column prop="createTime" label="添加时间" width="160px"></el-table-column>
                  <el-table-column label="操作">
                    <template slot-scope="scope">
                      <div class="btn">
                        <div class="edit" @click="expressDialog('编辑发票邮寄信息',2,scope.row)">编辑</div>
                        <div class="dele" @click="deleInvoice(scope.row.id,2)">删除</div>
                      </div>
                    </template>
                  </el-table-column>
                </el-table>
              </div>
            </el-tab-pane>
          </el-tabs>
        </div>
      </div>
    </div>
  </div>

  <!-- 尾部 -->
  <div class="footer">
    <div class="com-width">
      <div class="footer-content">
        <div class="footer-label">
          <div class="footer-cool" style="margin-bottom: 10px;">
            <span>Copyright © 2020-2021 17dc.com  丨  沪ICP备2021024815号-1  丨  <a target="_blank"
                                                                               href="./yingyezhizhaoImg.html"
                                                                               class="yingyezhizhao">营业执照</a></span>
          </div>
          <!-- <div class="footer-cool" style="margin-bottom: 10px;display: flex;align-items: center;justify-content: center;">
            <img src="./img/footer-wangjing.png" style="width: 16px;height: 16px;margin-right: 10px;" />
            <span>沪公网备XXXXXXXXXXXXX号</span>
          </div> -->
          <div class="footer-ipc">上海傲晔物流科技有限公司 丨 上海市青浦区诸光路1588弄虹桥世界中心L3B栋</div>
        </div>
        <div class="footer-img"><img alt="图片" src="./img/qcode.png"/></div>
      </div>
    </div>
  </div>
  <!--  发票抬头信息弹框-->
  <el-dialog :title="dialogTitle" :visible.sync="dialogFormVisible" width="550px">
    <el-form :model="form" :rules="rules" ref="ruleForm">
      <el-row>
        <el-col :span="20">
          <el-form-item label="发票抬头" prop="invoiceTitle" :label-width="formLabelWidth">
            <el-input v-model="form.invoiceTitle" autocomplete="off"></el-input>
          </el-form-item>
        </el-col>
      </el-row>
      <el-row>
        <el-col :span="20">
          <el-form-item label="纳税人识别号" prop="dutyParagraph" :label-width="formLabelWidth" required>
            <el-input v-model="form.dutyParagraph" autocomplete="off"></el-input>
          </el-form-item>
        </el-col>
      </el-row>
      <el-row>
        <el-col :span="20">
          <el-form-item label="公司地址" prop="companyAddress" :label-width="formLabelWidth" required>
            <el-input v-model="form.companyAddress" autocomplete="off"></el-input>
          </el-form-item>
        </el-col>
      </el-row>
      <el-row>
        <el-col :span="20">
          <el-form-item label="公司电话" prop="companyTel" :label-width="formLabelWidth" required>
            <el-input v-model.number="form.companyTel" maxlength="11" autocomplete="off"></el-input>
          </el-form-item>
        </el-col>
      </el-row>
      <el-row>
        <el-col :span="20">
          <el-form-item label="开户行" prop="accountBank" :label-width="formLabelWidth" required>
            <el-input v-model="form.accountBank" autocomplete="off"></el-input>
          </el-form-item>
        </el-col>
      </el-row>
      <el-row>
        <el-col :span="20">
          <el-form-item label="银行卡号" prop="bankAccount" :label-width="formLabelWidth" required>
            <el-input v-model.number="form.bankAccount" autocomplete="off"></el-input>
          </el-form-item>
        </el-col>
      </el-row>
    </el-form>
    <div slot="footer" class="dialog-footer">
      <el-button type="primary" @click="dialogSubmit('ruleForm',1)">确 定</el-button>
      <el-button @click="dialogFormVisible = false">取 消</el-button>

    </div>
  </el-dialog>
  <!--  发票邮寄信息弹框-->
  <el-dialog :title="dialogTitle" :visible.sync="expressdialogFormVisible" width="550px">
    <el-form :model="expressForm" :rules="rules" ref="expressruleForm">
      <el-row>
        <el-col :span="20">
          <el-form-item label="收件人" prop="recipient" :label-width="formLabelWidth">
            <el-input v-model="expressForm.recipient" autocomplete="off"></el-input>
          </el-form-item>
        </el-col>
      </el-row>

      <el-row>
        <el-col :span="20">
          <el-form-item label="联系电话" prop="recipientTel" :label-width="formLabelWidth" required>
            <el-input v-model.number="expressForm.recipientTel" maxLength="11" autocomplete="off"></el-input>
          </el-form-item>
        </el-col>
      </el-row>
      <el-row>
        <el-col :span="20">
          <el-form-item label="邮箱" prop="recipientEmail" :label-width="formLabelWidth" required>
            <el-input v-model="expressForm.recipientEmail" autocomplete="off"></el-input>
          </el-form-item>
        </el-col>
      </el-row>
      <el-row>
        <el-col :span="20">
          <el-form-item label="收件地址" prop="recipientAddress" :label-width="formLabelWidth" required>
            <el-input v-model="expressForm.recipientAddress" autocomplete="off"></el-input>
          </el-form-item>
        </el-col>
      </el-row>
    </el-form>
    <div slot="footer" class="dialog-footer">
      <el-button type="primary" @click="dialogSubmit('expressruleForm',2)">确 定</el-button>
      <el-button @click="expressdialogFormVisible = false">取 消</el-button>

    </div>
  </el-dialog>
</div>

</body>
<script src="./service/index.js"></script>
<script>
    new Vue({
        el: '#app',
        data() {
            let validateDutyParagraph = (rule, value, callback) => {
                let pattern = '/^[a-zA-Z0-9]{1,20}$/';
                if (value === '') {
                    callback(new Error('请输入纳税人识别号'));
                }
                if (value.search(/^[a-zA-Z0-9]{1,20}$/) == -1) {
                    if (value.length > 20) {
                        callback(new Error('最多20位'));
                    }
                    callback(new Error('只能为数值和字母'));
                }
                callback()
            };
            let validateCompanyTel = (rule, value, callback) => {
                var reg = /^((0\d{2,3}-\d{7,8})|(1[3584]\d{9}))$/;
                if (value === '') {
                    callback(new Error('请输入公司电话'));
                }
                console.log(value.toString().search(reg))
                if (value.toString().search(reg)) {
                    callback(new Error('请输入正确的电话'));
                }
                callback()
            };
            let validateBankAccount = (rule, value, callback) => {
                var reg = /^[0-9]{1,19}$/;
                if (value === '') {
                    callback(new Error('请输入银行卡号'));
                }
                if (value.toString().search(reg)) {
                    callback(new Error('请输入正确的银行卡号'));
                }
                callback()
            };
            let validateEmail = (rule, value, callback) => {
                var reg = /^\w+@[a-zA-Z0-9]{2,10}(?:\.[a-z]{2,4}){1,3}$/;
                if (value === '') {
                    callback(new Error('请输入邮箱'));
                }
                if (value.toString().search(reg)) {
                    callback(new Error('请输入正确的邮箱地址'));
                }
                callback()
            };
            return {
                dialogTitle: "新增发票抬头信息",
                dialogFormVisible: false,
                expressdialogFormVisible: false,
                dialogType: 1,
                form: {
                    invoiceTitle: '',
                    dutyParagraph: '',
                    companyAddress: '',
                    companyTel: '',
                    accountBank: '',
                    bankAccount: '',
                    id: ''
                },
                expressForm: {
                    id: 0,
                    recipient: "",
                    recipientAddress: "",
                    recipientEmail: "",
                    recipientTel: "",
                },
                formLabelWidth: '120px',
                invoiceListData: [],//抬头发票信息列表
                expressListData: [],//发票邮寄信息
                rules: {
                    invoiceTitle: [
                        {required: true, message: '请输入发票抬头', trigger: 'blur'},
                        {min: 1, max: 30, message: '长度在 1 到 30 个字符', trigger: 'blur'}
                    ],
                    dutyParagraph: [
                        {validator: validateDutyParagraph, trigger: 'blur'},
                    ],
                    companyAddress: [
                        {required: true, message: '请输入公司地址', trigger: 'blur'},
                        {min: 1, max: 50, message: '长度在 1 到 50个字符', trigger: 'blur'}
                    ],
                    companyTel: [
                        {validator: validateCompanyTel, trigger: 'blur'},

                    ],
                    accountBank: [
                        {required: true, message: '请输入开户行', trigger: 'blur'},
                        {min: 1, max: 11, message: '长度在 1 到 30个字符', trigger: 'blur'}
                    ],
                    bankAccount: [
                        {validator: validateBankAccount, trigger: 'blur'},
                    ],
                    recipient: [
                        {required: true, message: '请输入收件人', trigger: 'blur'},
                        {min: 1, max: 30, message: '长度在 1 到 30 个字符', trigger: 'blur'}
                    ],
                    recipientAddress: [
                        {required: true, message: '请输入收件地址', trigger: 'blur'},
                        {min: 1, max: 30, message: '长度在 1 到 50 个字符', trigger: 'blur'}
                    ],
                    recipientTel: [
                        {validator: validateCompanyTel, trigger: 'blur'},
                    ],
                    recipientEmail: [
                        {validator: validateEmail, trigger: 'blur'},
                    ],
                },
                loading: false,
                menuIndex: 0,
                userInfo: {},
                openId: '',
                headerMenu: false,
                departureDate1: '',
                departureDate2: '',
                departureDate3: '',
                typeCode: '发票开具',
                invoiceType: '',
                invoiceTypeOpt: [
                    {
                        Name: '增值税电子普通发票',
                        Value: '0'
                    },
                    {
                        Name: '增值税普通发票',
                        Value: '1'
                    },
                    {
                        Name: '增值税专用发票',
                        Value: '2'
                    }
                ],
                tableData: [],
                //发票开具
                tableData1: [],
                billAmountCnyTotal: 0,
                billAmountCnyArr: [],
                invoiceTitle: '',
                invoiceTitleOpt: [],
                invoiceTitleJson: {},
                recipient: '',
                recipientOpt: [],
                recipientJson: {},
                //发票信息
                tableData2: [],
                invoiceInfosPrice: 0,
                invoiceInfosArr: []
            }
        },
        created() {
            if (!localStorage.getItem('wxOpenId')) {
                window.location.href = './login.html'
            }
            if (localStorage.getItem('userInfo')) {
                this.userInfo = JSON.parse(localStorage.getItem('userInfo'))
            }
            this.openId = localStorage.getItem('wxOpenId')
            this.initUserInfo()
            this.initInvoiceInfoList()
            this.initExpressInfoList()
            this.initList()

        },
        methods: {
            indexMethod(index) {
                return index + 1;
            },
            dialogSubmit(formName, type = 1) {
                //type 1:发票抬头 2:发票邮寄
                this.$refs[formName].validate((valid) => {
                    if (valid) {
                        let url = "invoiceInfoSaveOrUpdate";
                        let data = this.form
                        if (type == 1) {
                            url = "invoiceInfoSaveOrUpdate";
                            data = this.form
                        }
                        if (type == 2) {
                            url = "expressInfoSaveOrUpdate";
                            data = this.expressForm
                        }
                        axios({
                            method: 'post',
                            url: webIp + serviceApi[url],
                            headers: {
                                'tokenId': localStorage.getItem('tokenId')
                            },
                            data: data
                        }).then((res) => {
                            let data = res.data
                            if (data.code == 200) {
                                this.$message({
                                    message: data.message,
                                    type: 'success'
                                });
                                this.dialogFormVisible = false;
                                this.expressdialogFormVisible = false;
                                //获取发票抬头信息列表
                                if (type == 1) {
                                    this.invoiceInfolist();
                                }
                                //获取发票邮寄信息列表
                                if (type == 2) {
                                    this.expressInfoList();
                                }

                            } else if (data.code == -200) {
                                window.location.href = './login.html'
                            } else {
                                this.$message.error(data.message)
                            }
                        })
                    } else {
                        console.log('error submit!!');
                        return false;
                    }
                });
            },
            deleInvoice(id,type=1) {
                //type 1:发票抬头 2：发票邮寄
                this.$confirm('此操作将永久删除该发票信息, 是否继续?', '提示', {
                    confirmButtonText: '确定',
                    cancelButtonText: '取消',
                    type: 'warning'
                }).then(() => {
                    let url = serviceApi.deleInvoice + `?invoiceInfoId=${id}`
                    if(type == 1){
                        url = serviceApi.deleInvoice + `?invoiceInfoId=${id}`
                    }
                    if(type == 2){
                        url = serviceApi.deleExpress + `?expressInfoId=${id}`
                    }
                    axios({
                        method: 'delete',
                        url: webIp + url,
                        headers: {
                            'tokenId': localStorage.getItem('tokenId')
                        },
                        data: {}
                    }).then((res) => {
                        let data = res.data
                        if (data.code == 200) {
                            this.$message({
                                message: data.message,
                                type: 'success'
                            });
                            this.dialogFormVisible = false;
                            //获取发票抬头信息列表
                            if (type == 1) {
                                this.invoiceInfolist();
                            }
                            //获取发票邮寄信息列表
                            if (type == 2) {
                                this.expressInfoList();
                            }
                        } else if (data.code == -200) {
                            window.location.href = './login.html'
                        } else {
                            this.$message.error(data.message)
                        }
                    })
                }).catch(() => {

                });

            },
            expressDialog(title = "新增", type = 1, data = null) {
                this.dialogTitle = title;
                this.expressdialogFormVisible = true;
                this.dialogType = type;
                // 1:新增 2:编辑
                if (type == 1) {
                    this.$refs.expressruleForm && this.$refs.expressruleForm.resetFields();
                    this.expressForm = {
                        id: 0,
                        recipient: "",
                        recipientAddress: "",
                        recipientEmail: "",
                        recipientTel: "",
                    }

                }
                if (data) {
                    for (let item in this.expressForm) {
                        this.expressForm[item] = data[item]
                    }
                }
            },
            changeDialog(title = "新增", type = 1, data = null) {
                this.dialogTitle = title;
                this.dialogFormVisible = true;
                this.dialogType = type;
                // 1:新增 2:编辑
                if (type == 1) {

                    this.$refs.ruleForm && this.$refs.ruleForm.resetFields();
                    this.form = {
                        invoiceTitle: '',
                        dutyParagraph: '',
                        companyAddress: '',
                        companyTel: '',
                        accountBank: '',
                        bankAccount: '',
                        id: ''
                    }

                }
                if (data) {
                    for (let item in this.form) {
                        this.form[item] = data[item]
                    }
                }

            },
            expressInfoList() {
                axios({
                    method: 'get',
                    url: webIp + serviceApi.expressInfoList,
                    headers: {
                        'tokenId': localStorage.getItem('tokenId')
                    },
                    data: this.form
                }).then((res) => {
                    let data = res.data
                    if (data.code == 200) {
                        this.expressListData = data.data;
                    } else if (data.code == -200) {
                        window.location.href = './login.html'
                    } else {
                        this.$message.error(data.message)
                    }
                })
            },
            invoiceInfolist() {
                axios({
                    method: 'get',
                    url: webIp + serviceApi.invoiceInfoList,
                    headers: {
                        'tokenId': localStorage.getItem('tokenId')
                    },
                    data: this.form
                }).then((res) => {
                    let data = res.data
                    if (data.code == 200) {
                        this.invoiceListData = data.data;
                    } else if (data.code == -200) {
                        window.location.href = './login.html'
                    } else {
                        this.$message.error(data.message)
                    }
                })
            },
            InvoicingClick(type) {
                if (type == '票据') {
                    this.$message.error('正在开发请稍后再试')
                    return
                }
                if (this.billAmountCnyArr.length == 0) {
                    this.$message.error('请选择开票数据')
                    return
                } else if (!this.invoiceType) {
                    this.$message.error('请选择发票类型')
                    return
                } else if (!this.invoiceTitle) {
                    this.$message.error('请选择发票抬头')
                    return
                } else if (!this.recipient) {
                    this.$message.error('请选择收件人')
                    return
                }
                if (type == '合并' || type == '单独') {
                    var billIds = []
                    for (var i = 0; i < this.billAmountCnyArr.length; i++) {
                        billIds.push(this.billAmountCnyArr[i].id)
                    }
                    var data = {
                        accountBank: this.invoiceTitleJson.accountBank,
                        applyAmount: this.billAmountCnyTotal,
                        bankAccount: this.invoiceTitleJson.bankAccount,
                        billIds: billIds,
                        companyAddress: this.invoiceTitleJson.companyAddress,
                        companyTel: this.invoiceTitleJson.companyTel,
                        dutyParagraph: this.invoiceTitleJson.dutyParagraph,
                        invoiceTitle: this.invoiceTitleJson.invoiceTitle,
                        invoiceType: this.invoiceType,
                        merge: type == '合并' ? 0 : 1,
                        recipient: this.recipientJson.recipient,
                        recipientAddress: this.recipientJson.recipientAddress,
                        recipientEmail: this.recipientJson.recipientEmail,
                        recipientTel: this.recipientJson.recipientTel
                    }
                    axios({
                        method: 'post',
                        url: webIp + serviceApi.invoiceApply,
                        data: data,
                        headers: {
                            'tokenId': localStorage.getItem('tokenId')
                        }
                    }).then((data) => {
                        var data = data.data
                        if (data.code == 200) {
                            this.initList()
                            this.$message.success('开票成功')
                        } else if (data.code == -200) {
                            window.location.href = './login.html'
                        } else {
                            this.$message.error(data.message)
                        }
                    })
                }
            },
            invoiceInfosChange(val) {
                this.invoiceInfosPrice = 0
                this.invoiceInfosArr = []
                if (val.length > 0) {
                    for (var i = 0; i < val.length; i++) {
                        this.invoiceInfosPrice += val[i].applyAmount
                        for (var q = 0; q < val[i].billInfos.length; q++) {
                            this.invoiceInfosArr.push(val[i].billInfos[q])
                        }
                    }
                }
            },
            selectionChange(val) {
                this.billAmountCnyArr = val
                this.billAmountCnyTotal = 0
                if (val.length > 0) {
                    for (var i = 0; i < val.length; i++) {
                        this.billAmountCnyTotal += val[i].billAmountCny
                    }
                }
            },
            invoiceTitleChange(e) {
                for (var q = 0; q < this.invoiceTitleOpt.length; q++) {
                    if (e == this.invoiceTitleOpt[q].invoiceTitle) {
                        this.invoiceTitleJson = this.invoiceTitleOpt[q]
                    }
                }
            },
            expressInfoChange(e) {
                console.log(e)
                for (var q = 0; q < this.recipientOpt.length; q++) {
                    if (e == this.recipientOpt[q].recipient) {
                        this.recipientJson = this.recipientOpt[q]
                    }
                }
            },
            initInvoiceInfoList() {
                axios({
                    method: 'get',
                    url: webIp + serviceApi.invoiceInfoList,
                    headers: {
                        'tokenId': localStorage.getItem('tokenId')
                    }
                }).then((data) => {
                    var data = data.data
                    if (data.code == 200) {
                        this.invoiceTitleOpt = data.data
                        this.invoiceTitle = data.data[0].invoiceTitle
                        this.invoiceTitleJson = data.data[0]
                    } else if (data.code == -200) {
                        window.location.href = './login.html'
                    } else {
                        this.$message.error(data.message)
                    }
                })
            },
            initExpressInfoList() {
                axios({
                    method: 'get',
                    url: webIp + serviceApi.expressInfoList,
                    headers: {
                        'tokenId': localStorage.getItem('tokenId')
                    }
                }).then((data) => {
                    var data = data.data
                    if (data.code == 200) {
                        this.recipientOpt = data.data
                        this.recipient = data.data[0].recipient
                        this.recipientJson = data.data[0]
                    } else if (data.code == -200) {
                        window.location.href = './login.html'
                    } else {
                        this.$message.error(data.message)
                    }
                })
            },
            tabClickData(e) {
                this.typeCode = e.paneName
                if (this.typeCode == '发票开具') {
                    this.initList()
                } else if (this.typeCode == '开票信息') {
                    //获取发票抬头信息列表
                    this.invoiceInfolist();
                    //获取发票邮寄信息
                    this.expressInfoList();
                } else if (this.typeCode == '财务核销') {
                    this.departureDate3 = ''
                }
            },
            initInvoiceInfos() {
                var json = {
                    startDepartureDate: this.departureDate2 == '' ? '' : this.departureDate2[0],
                    endDepartureDate: this.departureDate2 == '' ? '' : this.departureDate2[1]
                }
                json = toData(json)
                axios({
                    method: 'get',
                    url: webIp + serviceApi.invoiceInfos + '?' + json,
                    headers: {
                        'tokenId': localStorage.getItem('tokenId')
                    }
                }).then((data) => {
                    var data = data.data
                    if (data.code == 200) {
                        this.tableData2 = data.data
                    } else if (data.code == -200) {
                        window.location.href = './login.html'
                    } else {
                        this.$message.error(data.message)
                    }
                })
            },


            initList() {
                var json = {
                    startDepartureDate: this.departureDate1 == '' ? '' : this.departureDate1[0],
                    endDepartureDate: this.departureDate1 == '' ? '' : this.departureDate1[1]
                }
                json = toData(json)
                axios({
                    method: 'get',
                    url: webIp + serviceApi.billList + '?' + json,
                    headers: {
                        'tokenId': localStorage.getItem('tokenId')
                    }
                }).then((data) => {
                    var data = data.data
                    if (data.code == 200) {
                        this.tableData1 = data.data
                    } else if (data.code == -200) {
                        window.location.href = './login.html'
                    } else {
                        this.$message.error(data.message)
                    }
                })
            },
            initUserInfo() {
                axios({
                    method: 'get',
                    url: webIp + serviceApi.userUserInfo + '?openId=' + this.openId,
                    headers: {
                        'tokenId': localStorage.getItem('tokenId')
                    }
                }).then((data) => {
                    var data = data.data
                    if (data.code == 200) {
                        this.userInfo = data.data.tportalUser
                    } else if (data.code == -200) {
                        window.location.href = './login.html'
                    } else {
                        this.$message.error(data.message)
                    }
                })
            },
            searchClick() {
                if (this.typeCode == '发票开具') {
                    this.initList()
                } else if (this.typeCode == '发票信息') {
                    this.initInvoiceInfos()
                } else if (this.typeCode == '财务核销') {
                    this.departureDate3 = ''
                }
            },
            restClick() {
                if (this.typeCode == '发票开具') {
                    this.departureDate1 = ''
                } else if (this.typeCode == '发票信息') {
                    this.departureDate2 = ''
                } else if (this.typeCode == '财务核销') {
                    this.departureDate3 = ''
                }
                this.initList()
            },
            showHeaderMenu(type) {
                if (type == 1) {
                    this.headerMenu = true
                } else {
                    this.headerMenu = false
                }
            },
            tuiChu() {
                localStorage.clear()
                window.location.href = './login.html'
            },
            //登录
            loginClick() {
                window.location.href = './login.html'
            },
            // muen
            menuClick(index) {
                this.menuIndex = index
                if (index == 0) {
                    window.location.href = './index.html'
                } else if (index == 1) {
                    window.location.href = './orderList.html'
                } else if (index == 3) {
                    window.location.href = './about_us.html'
                }
            }
        }
    })
</script>
</html>
