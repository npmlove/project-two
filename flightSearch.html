<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport"
        content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover">
  <meta name="format-detection" content="telephone=no,address=no,email=no">
  <meta name="applicable-device" content="pc,mobile">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <meta http-equiv="Cache-Control" content="no-transform">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="renderer" content="webkit">
  <meta name="description" content="领先的国际货运智能化数字服务平台，拥有极速订舱、在线报关、航班跟踪、舱单生成四大功能，为国际货运企业提供灵活、专业、高效的一站式国际货运解决方案。">
  <meta name="keywords" content="空运,货运代理,航空货运,空运价格,国际货代,国际空运,订舱,空运货物查询跟踪,订舱报价,空运舱位,空运费查询,跨境物流,走空运找哪里">
  <link rel='icon' href='./img/favicon.ico' type='image/x-icon'/>
  <title>17订舱-国际货代-空运价格-在线订舱-航线-一站式国际货运在线服务平台</title>
  <link rel="stylesheet" href="./css/element-ui-min.css">
  <link rel="stylesheet" href="./css/reset.css"/>
  <link rel="stylesheet" href="./css/common.css"/>
  <link rel="stylesheet" href="./css/flightSearch.css"/>
  <script src="./js/vue.js"></script>
  <script src="./js/axios.min.js"></script>
  <script src="./js/element-ui.js"></script>
  <script>
      var _hmt = _hmt || [];
      (function () {
          var hm = document.createElement("script");
          hm.src = "https://hm.baidu.com/hm.js?6557743b6903181767d9b1a4d7458530";
          var s = document.getElementsByTagName("script")[0];
          s.parentNode.insertBefore(hm, s);
      })();
  </script>
</head>
<body>
<div id="app">
  <!-- 头部 -->
  <div class="header">
    <div class="header-img">
      <a href="./index.html">
        <!-- <img class="logo" src="./img/logo.png" /> -->
        <div class="logo"></div>
      </a>
      <div class="logo-title"></div>
    </div>
    <div v-if="userInfo" @mousemove="showHeaderMenu(1)" @mouseout="showHeaderMenu(2)" class="header-userInfo">
      <img class="header-imgUrl" :src="userInfo.headImgUrl"/>
      <div v-show="headerMenu" style="display: none;" class="header-userInfo-menu">
        <div class="header-userInfo-menu-name">{{userInfo.nickname}}</div>
        <div class="header-bak"><a href="./corporate.html">企业认证</a></div>
        <div class="header-bak"><a href="./orderList.html">订单管理</a></div>
        <div class="header-bak"><a href="./financial.html">财务管理</a></div>
        <div @click="tuiChu" class="header-bak">退出</div>
      </div>
    </div>
    <div v-else @click="loginClick" class="header-user">登录</div>
  </div>
  <div class="header-menu">
    <ul class="header-menu-list com-width">
      <li @click="menuClick(0)" :class="{headerActive: menuIndex == 0}" class="header-menu-content">首页</li>
      <li @click="menuClick(1)" :class="{headerActive: menuIndex == 1}" class="header-menu-content">订单跟踪</li>
      <!-- <li @click="menuClick(2)" :class="{headerActive: menuIndex == 2}" class="header-menu-content">行业咨询</li> -->
      <li @click="menuClick(3)" :class="{headerActive: menuIndex == 3}" class="header-menu-content">关于我们</li>
    </ul>
  </div>
  <!-- 查询内容 -->
  <div class="modify-flight" style="margin-top: 0;padding-top: 0;">
    <div class="modify-search-box" style="background-color: #FFF;padding-bottom: 20px;margin-bottom: 20px;">
      <div class="modify-search-img"></div>
      <div class="modify-search-form search">
        <div class="searchBox">
          <div>航班号</div>
          <input class="searchInput" v-model="searchValue" placeholder="请输入"/>
        </div>

        <button @click="submitQuery" class="searchBtn btn-prprimary">立即查询</button>
      </div>
    </div>
    <template v-if="dataInfo">
      <div class="com-width">
        <div class="infoDetail">
          <div class="flightNumber">
            航班号：{{dataInfo && dataInfo.airlineId}}
          </div>
          <div class="startEnd">
            <div class="start info">
              <div>{{dataInfo.lastFlightData.org}}</div>
              <div>{{dataInfo.lastFlightData.orgCh}}</div>
              <div>{{dataInfo.lastFlightData.etdDate}}</div>
              <div>{{dataInfo.lastFlightData.etdTime}}</div>
              <div>起飞</div>
            </div>
            <div class="center">
              <div class="line"></div>
              <p>{{dataInfo.lastFlightData.flightTime}}</p>
            </div>
            <div class="end info">
              <div>{{dataInfo.lastFlightData.des}}</div>
              <div>{{dataInfo.lastFlightData.desCh}}</div>
              <div>{{dataInfo.lastFlightData.etaDate}}</div>
              <div>{{dataInfo.lastFlightData.etaTime}}</div>
              <div>降落</div>
            </div>
          </div>
        </div>
      </div>
      <div class="com-width">
        <div id="Map">

        </div>
      </div>
      <div class="com-width">
        <div class="infoList">
          <div class="title">历史航班</div>
          <div class="listTable">
            <div class="tableTitle pub">
              <div class="date">日期</div>
              <div>离港</div>
              <div>飞行时间</div>
              <div>到港</div>
            </div>
            <div class="tableList pub" v-for="(item,index) in dataInfo.hisFlightDatas" :key="index">
              <div class="date">{{item.atdDate}}</div>
              <div>
                <p>{{item.atdTime}}</p>
                <div class="startList">
                  <div>{{item.org}}</div>
                  <div></div>
                </div>
              </div>
              <div>
                <div style="color: #999999;position: relative">
                  {{item.flightTime}}
                </div>
                <div class="startList">
                  <div style="width: 30%">
                    <img src="img/aircraft.png" style="width: 20px;height: 20px;margin-left: 15px;">
                  </div>
                  <div style="width: 70%"></div>
                </div>
              </div>
              <div>
                <p>{{item.ataTime}}
                  <span class="tig" v-if="item.daysRound">+{{item.daysRound}}</span>
                </p>
                <div class="startList">
                  <div>{{item.des}}</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </template>
    <div class="modify-result-wrapper com-width" v-else>
      <div style="width: 100%;text-align: center;padding: 20px;">
        <img alt="图片" style="width: 262px;height: 201px;" src="./img/null.png"/>
        <div style="color: #999;font-size: 14px;margin-top: 20px;">暂无数据</div>
      </div>
    </div>
  </div>

  <!-- 尾部 -->
  <div class="footer">
    <div class="com-width">
      <div class="footer-content">
        <div class="footer-label">
          <div class="footer-cool" style="margin-bottom: 10px;">
            <span>Copyright © 2020-2021 17dc.com  丨  沪ICP备2021024815号-1  丨  <a target="_blank"
                                                                               href="./yingyezhizhaoImg.html"
                                                                               class="yingyezhizhao">营业执照</a></span>
          </div>
          <!-- <div class="footer-cool" style="margin-bottom: 10px;display: flex;align-items: center;justify-content: center;">
            <img src="./img/footer-wangjing.png" style="width: 16px;height: 16px;margin-right: 10px;" />
            <span>沪公网备XXXXXXXXXXXXX号</span>
          </div> -->
          <div class="footer-ipc">上海傲晔物流科技有限公司 丨 上海市青浦区诸光路1588弄虹桥世界中心L3B栋</div>
        </div>
        <div class="footer-img"><img alt="图片" src="./img/qcode.png"/></div>
      </div>
    </div>
  </div>
</div>
</body>
<script type="text/javascript"
        src="https://webapi.amap.com/maps?v=1.4.14&key=07536db46b52555c8782a4e5667fee2d"></script>
<script src="./service/index.js"></script>
<script>
    new Vue({
        el: '#app',
        data: {
            //菜单
            menuArr: [
                {name: '首页'},
                {name: '订单跟踪'},
                {name: '行业咨询'},
                {name: '关于我们'}
            ],
            menuIndex: 0,
            userInfo: '',
            headerMenu: false,
            searchValue: "",
            dataInfo: null,
            lineArr:[]
        },
        created() {
            if (!localStorage.getItem('wxOpenId')) {
                window.location.href = './login.html'
            }
            if (localStorage.getItem('userInfo')) {
                this.userInfo = JSON.parse(localStorage.getItem('userInfo'))
            }
            this.searchValue = getQueryVariable('serach')
            this.getData()
        },
        mounted() {

        },
        methods: {
            getData() {
                axios({
                    method: 'post',
                    url: webIp + serviceApi.airLineSearch,
                    data: {
                        airLineId: this.searchValue
                    }
                }).then((res) => {
                    if (res.data.code == 200) {
                        this.dataInfo = res.data.data;
                        if(res.data.data.points){
                            res.data.data.points.forEach((item)=>{
                                this.lineArr.push([
                                    item.longitude,item.latitude
                                ])
                            })
                        }
                        if(res.data.data.hisFlightDatas){
                            res.data.data.hisFlightDatas.forEach((item)=>{
                                let time = new Date(item.ataDate) - new Date(item.atdDate)
                                let  days    = time / 1000 / 60 / 60 / 24;
                                let  daysRound = Math.floor(days);
                                item.daysRound = daysRound
                            })
                        }
                        this.$nextTick(() => {
                            this.initMap()
                        })
                    }
                })
            },
            completeEventHandler(map) {
                // 地图图块加载完毕后执行函数
                let lineArr = []
                this.lineArr && this.lineArr.forEach((item)=>{
                    let icon = "img/aircraft.png"
                    new AMap.Marker({
                        map: map,
                        position: item,
                        icon: icon,
                        offset: new AMap.Pixel(-26, -13),
                        autoRotation: true
                    });
                })

                // 绘制轨迹
                let polyline= new AMap.Polyline({
                    map: map,
                    path: [this.lineArr[0],this.lineArr[2]],
                    strokeColor: "#FF1414",  //线颜色
                    strokeOpacity: 1,     //线透明度
                    strokeWeight: 3,      //线宽
                    strokeStyle: "solid",  //线样式
                });
                let polyline1 =  new AMap.Polyline({
                    map: map,
                    path: [this.lineArr[1],this.lineArr[2]],
                    strokeColor: "#FF1414",  //线颜色
                    strokeOpacity: 1,     //线透明度
                    strokeWeight: 3,      //线宽
                    strokeStyle: "dashed",  //线样式
                });
                map.add(polyline);
                map.add(polyline1);
                map.setCenter(this.lineArr[2])

            },
            initMap() {
                //叠加谷歌地图
                var googleLayer = null;
                // 添加Google图层
                googleLayer = new AMap.TileLayer({
                    // 图块取图地址
                    getTileUrl: 'https://17dc.shenghuoq.com/map/vt/lyrs=m@142&hl=zh-CN&gl=cn&x=[x]&y=[y]&z=[z]&s=Galil',
                    zIndex: 9
                });
                let Sate = new AMap.TileLayer.Satellite();
                var map = new AMap.Map('Map', {
                    zoom: 1,
                    viewMode: '2D',
                    center: this.lineArr[2]?this.lineArr[2]:[116.408075, 39.950187],
                    layers: [googleLayer, Sate],
                    resizeEnable: true, //是否监控地图容器尺寸变化
                });
                map.on("complete", this.completeEventHandler(map));


            },
            submitQuery() {
                this.getData()
            },
            showHeaderMenu(type) {
                if (type == 1) {
                    this.headerMenu = true
                } else {
                    this.headerMenu = false
                }
            },
            tuiChu() {
                localStorage.clear()
                window.location.href = './login.html'
            },
            //登录
            loginClick() {
                window.location.href = './login.html'
            },
            // muen
            menuClick(index) {
                this.menuIndex = index
                if (index == 0) {
                    window.location.href = './index.html'
                } else if (index == 1) {
                    window.location.href = './orderList.html'
                } else if (index == 2) {
                    window.location.href = './addressSerach.html'
                } else if (index == 3) {
                    window.location.href = './about_us.html'
                }
            }
        }
    })
</script>
</html>
